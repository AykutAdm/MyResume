@using MyPortfolio.Entities
@model List<Message>

<div class="relative">
    <button id="messageDropdownBtn" class="relative p-2 text-slate-500 dark:text-[#9db2b9] hover:bg-slate-100 dark:hover:bg-[#283539] rounded-lg transition-colors">
        <span class="material-symbols-outlined">mail</span>
        @if (Model != null && Model.Count > 0)
        {
            <span class="absolute top-2 right-2.5 w-2 h-2 bg-primary rounded-full border-2 border-white dark:border-[#111618]"></span>
        }
    </button>
    <div id="messageDropdown" class="absolute right-0 mt-2 w-80 bg-white dark:bg-[#111618] rounded-lg shadow-xl border border-slate-200 dark:border-[#283539] z-50 hidden">
        <div class="p-4 border-b border-slate-200 dark:border-[#283539]">
            <h3 class="text-sm font-bold text-slate-900 dark:text-white">Okunmamış Mesajlar</h3>
        </div>
        <div id="messageList" class="max-h-96 overflow-y-auto">
            @if (Model != null && Model.Count > 0)
            {
                @foreach (var message in Model)
                {
                    <a href="/Message/MessageList/" class="block p-4 border-b border-slate-200 dark:border-[#283539] hover:bg-slate-50 dark:hover:bg-[#1c2427] transition-colors">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0">
                                <span class="text-primary text-xs font-bold">@(!string.IsNullOrEmpty(message.NameSurname) ? message.NameSurname.Substring(0, 1).ToUpper() : "?")</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="text-sm font-bold text-slate-900 dark:text-white truncate">@message.NameSurname</div>
                                <div class="text-xs font-semibold text-primary mt-1 truncate">@message.Subject</div>
                                <div class="text-xs text-slate-500 dark:text-[#9db2b9] mt-1 line-clamp-2">@(!string.IsNullOrEmpty(message.MessageDetail) && message.MessageDetail.Length > 60 ? message.MessageDetail.Substring(0, 60) + "..." : message.MessageDetail)</div>
                                <div class="text-[10px] text-slate-400 dark:text-[#6b7f87] mt-1">@message.SendDate.ToString("dd.MM.yyyy HH:mm")</div>
                            </div>
                        </div>
                    </a>
                }
            }
            else
            {
                <div class="p-4 text-center text-sm text-slate-500 dark:text-[#9db2b9]">Okunmamış mesaj bulunmuyor.</div>
            }
        </div>
        <div class="p-3 border-t border-slate-200 dark:border-[#283539]">
            <a href="/Message/MessageList/" class="block text-center text-sm text-primary hover:underline font-medium">
                Tüm Mesajları Görüntüle
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dropdownBtn = document.getElementById('messageDropdownBtn');
        const dropdown = document.getElementById('messageDropdown');

        if (dropdownBtn && dropdown) {
            // Dropdown aç/kapa
            dropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdown.classList.toggle('hidden');
            });

            // Dışarı tıklandığında kapat
            document.addEventListener('click', function(e) {
                if (!dropdown.contains(e.target) && !dropdownBtn.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
        }
    });
</script>

